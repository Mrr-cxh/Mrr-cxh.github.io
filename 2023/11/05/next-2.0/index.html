<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Next 2.0, Mrr-cxh">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Next 2.0 | Mrr-cxh</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Mrr-cxh" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Mrr-cxh</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Mrr-cxh</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/Mrr-cxh/Mrr-cxh.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/Mrr-cxh/Mrr-cxh.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/7.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Next 2.0</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%A1%86%E6%9E%B6/">
                                <span class="chip bg-color">框架</span>
                            </a>
                        
                            <a href="/tags/Next/">
                                <span class="chip bg-color">Next</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%A1%86%E6%9E%B6/" class="post-category">
                                框架
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-11-05
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2023-12-10
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    6.2k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    24 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="进入生产阶段"><a class="markdownIt-Anchor" href="#进入生产阶段">#</a> 进入生产阶段</h1>
<p>在将 Next.js 应用程序投入生产之前，以下是一些确保最佳用户体验的建议。</p>
<ul>
<li>尽可能使用缓存</li>
<li>确保您的数据库和后端部署在同一区域。</li>
<li>目标是尽可能减少 JavaScript 的数量。</li>
<li>推迟加载繁重的 JavaScript 包，直到需要时才加载。</li>
<li>确保日志记录已设置。</li>
<li>确保错误处理已设置。</li>
<li>配置 404（未找到）和 500（错误）页面。</li>
<li>使用以下方法提高性能：
<ul>
<li>第一章提到的 next/image 和自动图像优化</li>
<li>第一章提到的自动字体优化</li>
<li>第一章提到的脚本优化</li>
</ul>
</li>
</ul>
<h2 id="缓存"><a class="markdownIt-Anchor" href="#缓存">#</a> 缓存</h2>
<p>缓存可缩短响应时间并减少对外部服务的请求数量。 <code>/_next/static</code>  Next.js 自动将缓存标头添加到由 JavaScript、CSS、静态图像和其他媒体提供的不可变资产中。</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">Cache-Control: public, max-age=31536000, immutable<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>next.config.js</code>  中设置的 <code>Cache-Control</code>  将在生产中被覆盖，以确保静态资产可以有效缓存。如果需要重新验证静态生成的页面的缓存，可以通过在页面的  <code>getStaticProps</code>  函数中进行设置 <code>revalidate</code>  来实现。如果您使用 <code>next/image</code> ，则默认的 image Optimization 也有特定的缓存规则。<br>
 <code>注意</code> ：当使用 本地运行应用程序时  <code>next dev</code> ，您的标头将被覆盖，以防止在本地缓存。</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">Cache-Control: no-cache, no-store, max-age=0, must-revalidate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>您还可以使用  <code>getServerSideProps</code>  和 API 路由中的缓存头来进行动态响应。例如，使用  <code>stale-while-revalidate</code></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 该值在10秒内被认为是新鲜的（s-maxage=10）</span>
<span class="token comment">// 如果在接下来的10秒内重复请求，缓存的值仍然是新的。如果在59秒之前重复请求，缓存的值将是过时的，但仍然呈现（stale-while-revalidate=59）</span>
<span class="token comment">// 在后台，将发出重新验证请求以填充缓存具有新值。如果刷新页面，您将看到新值。</span>
<span class="token comment">// with a fresh value. If you refresh the page, you will see the new value.</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span>
    <span class="token string">"Cache-Control"</span><span class="token punctuation">,</span>
    <span class="token string">"public, s-maxage=10, stale-while-revalidate=59"</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="减少-javascript-大小"><a class="markdownIt-Anchor" href="#减少-javascript-大小">#</a> 减少 JavaScript 大小</h2>
<p>为了减少发送到浏览器的 JavaScript 数量，您可以使用以下工具来了解每个 JavaScript 包中包含的内容：</p>
<ul>
<li><code>Import Cost</code>  – 在 VSCode 中显示导入包的大小。</li>
<li><code> Package Phobia</code>  – 查找在项目中添加新的开发依赖项的成本。</li>
<li><code>Bundle Phobia</code>  - 分析依赖项可以在多大程度上增加 bundle 大小。</li>
<li><code>Webpack Bundle Analyzer</code>  – 使用交互式、可缩放的树图可视化 webpack 输出文件的大小。</li>
</ul>
<p>在  <code>next build</code>  中， <code>pages/</code>  目录中的每个文件都将自动被代码拆分为自己的 JavaScript 捆绑包。您还可以使用 “动态导入” 来延迟加载组件和库。例如，您可能希望推迟加载模块代码，直到用户单击打开按钮。</p>
<h2 id="记录logging"><a class="markdownIt-Anchor" href="#记录logging">#</a> 记录 (logging)</h2>
<p>由于 Next.js 在客户端和服务器上运行，因此支持多种形式的日志记录：</p>
<ul>
<li><code>console.log</code>  在浏览器中</li>
<li><code>stdout</code>  在服务器上</li>
</ul>
<h1 id="部署"><a class="markdownIt-Anchor" href="#部署">#</a> 部署</h1>
<h2 id="nodejs-服务器"><a class="markdownIt-Anchor" href="#nodejs-服务器">#</a> Node.js 服务器</h2>
<p>Next.js 可以部署到任何支持 Node.js 的托管提供商处。确保你的  <code>package.json</code>  文件中设置了  <code>package.json</code>  文件中存在  <code>"build"</code>  和  <code>"start"</code>  两个构建命令。</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"next dev"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"next build"</span><span class="token punctuation">,</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"next start"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>执行  <code>next build</code>  命令将在  <code>.next</code>  文件夹中构建出用于生产环境的应用程序。构建之后，执行  <code>next start</code>  命令启动一个支持 混合页面（hybrid pages） 的 Node.js 服务程序，该服务程序将同时服务于 <code>静态生成的页面和服务器端渲染的页面</code> 。</p>
<p>If you are using next/image, consider adding sharp for more performant Image Optimization in your production environment by running npm install sharp in your project directory. On Linux platforms, sharp may require additional configuration to prevent excessive memory usage.</p>
<p>如果你正在使用  <code>next/image</code> ，请考虑通过在项目目录中运行  <code>npm install sharp</code> ，在生产环境中添加  <code>sharp</code>  以获得更高性能的图像优化。在 Linux 平台上， <code>sharp</code>  可能需要额外的配置，以防止过度使用内存。</p>
<h2 id="docker-镜像"><a class="markdownIt-Anchor" href="#docker-镜像">#</a> Docker 镜像</h2>
<p>具体查看官网</p>
<h1 id="身份验证"><a class="markdownIt-Anchor" href="#身份验证">#</a> 身份验证</h1>
<p>身份验证去验证用户是谁，而授权控制用户可以访问的内容。</p>
<h2 id="身份验证模式"><a class="markdownIt-Anchor" href="#身份验证模式">#</a> 身份验证模式</h2>
<p>确定您需要哪种身份验证模式的第一步是 <code>了解您想要的数据获取策略</code> 。然后我们可以确定哪些身份验证提供商支持此策略。主要有 <code>两种模式</code> ：</p>
<ul>
<li>
<p>使用静态生成来服务器渲染加载状态，然后在客户端获取用户数据。</p>
<p>如果没有阻塞数据要求，Next.js 会自动确定页面是静态的。这意味着页面中不存在  <code>getInitialProps</code>  和  <code>getServerSideProps</code> 。 相反，你的页面可以从服务器呈现加载状态，然后从客户端获取用户。</p>
<p>这种模式的一个优点是，它允许从全局 CDN 提供页面，并使用 next/link 进行预加载。在实践中，这会导致更快的 TTI（交互时间）。</p>
<p>示例：这将首先渲染加载骨架。一旦对用户的请求完成，它将显示用户的姓名：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// pages/profile.js</span>

<span class="token keyword">import</span> useUser <span class="token keyword">from</span> <span class="token string">"../lib/useUser"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">"../components/Layout"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Profile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fetch the user client-side</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> redirectTo<span class="token operator">:</span> <span class="token string">"/login"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Server-render loading state</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user <span class="token operator">||</span> user<span class="token punctuation">.</span>isLoggedIn <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Once the user request finishes, show the user</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Your Profile<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>pre<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Profile<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>在服务器端获取用户数据，以消除未经身份验证的内容的闪现。<br>
如果从页面导出一个名为  <code>getServerSideProps</code>  的异步函数，Next.js 将使用  <code>getServerSideProps</code>  返回的数据在每个请求中预呈现该页面。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 将作为props传递给页面组件</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// pages/profile.js</span>

<span class="token keyword">import</span> withSession <span class="token keyword">from</span> <span class="token string">"../lib/session"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">"../components/Layout"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> getServerSideProps <span class="token operator">=</span> <span class="token function">withSession</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      redirect<span class="token operator">:</span> <span class="token punctuation">{</span>
        destination<span class="token operator">:</span> <span class="token string">"/login"</span><span class="token punctuation">,</span>
        permanent<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Profile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Show the user. No loading state is required</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Your Profile<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>pre<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Profile<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这种模式的一个优点是在重定向之前防止未经身份验证的内容展示。需要注意的是，在 getServerSideProps 中获取用户数据将阻止渲染，直到对身份验证提供程序的请求得到解决。为了防止造成瓶颈并增加 TTFB（第一个字节的时间），您应该确保身份验证查找很快。否则，请考虑静态生成。</p>
</li>
</ul>
<h1 id="高级特性"><a class="markdownIt-Anchor" href="#高级特性">#</a> 高级特性</h1>
<h2 id="nextjs-编译器"><a class="markdownIt-Anchor" href="#nextjs-编译器">#</a> Next.js 编译器</h2>
<p>Next.js 编译器是使用  <code>SWC</code>  在 Rust 中编写的，它允许 Next.js 转换和缩小你的 JavaScript 代码以用于生产。这取代了用于单个文件的 Babel 和用于缩小输出打包的 Terser。</p>
<p>使用 Next.js 编译器编译比 Babel 快 17 倍，并且从 Next12 版本开始默认启用。如果您有现有的 Babel 配置或正在使用不受支持的功能，您的应用程序将选择退出 Next.js 编译器，继续使用 Babel。</p>
<h3 id="为什么选择-swc"><a class="markdownIt-Anchor" href="#为什么选择-swc">#</a> 为什么选择 SWC</h3>
<p>SWC 是一个基于 Rust 的可扩展平台，适用于下一代快速开发工具。<br>
SWC 可用于编译、缩小、打包等，并且被设计为可扩展。您可以调用它来执行代码转换（内置或自定义）。运行这些转换是通过 Next.js 等更高级别的工具进行的。<br>
选择基于 SWC 进行构建有以下几个原因：</p>
<ul>
<li><code>可扩展性</code> ：SWC 可以用作 Next.js 中的 Crate，而无需分叉库或解决设计约束。</li>
<li><code>性能</code> ：通过切换到 SWC，我们能够在 Next.js 中实现约 3 倍的快速刷新速度和约 5 倍的构建速度，并且仍有更多优化空间。</li>
<li><code>WebAssembly</code> ：Rust 对 WASM 的支持对于支持所有可能的平台以及在任何地方进行 Next.js 开发至关重要。</li>
<li><code>社区</code> ：Rust 社区和生态系统非常出色，并且仍在不断发展。</li>
</ul>
<h3 id="实验特点"><a class="markdownIt-Anchor" href="#实验特点">#</a> 实验特点</h3>
<ul>
<li>
<p>缩小化</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// next.config.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  swcMinify<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>您可以选择使用 Next.js 编译器进行缩小。这比 Terser 快 7 倍。</p>
</li>
<li>
<p>样式化组件 (看文档)</p>
</li>
<li>
<p>Jest (看文档)</p>
</li>
<li>
<p>遗留装饰器 (看文档)</p>
</li>
<li>
<p>导入源 (看文档)</p>
</li>
<li>
<p>不支持的功能<br>
当您的应用程序有一个 <code>.babelrc</code>  文件时，Next.js 将自动回退到使用 Babel 来转换单个文件。这确保了与利用自定义 Babel 插件的现有应用程序的向后兼容性。</p>
</li>
</ul>
<h2 id="动态导入"><a class="markdownIt-Anchor" href="#动态导入">#</a> 动态导入</h2>
<h3 id="基本用法"><a class="markdownIt-Anchor" href="#基本用法">#</a> 基本用法</h3>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> dynamic <span class="token keyword">from</span> <span class="token string">"next/dynamic"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> DynamicComponent <span class="token operator">=</span> <span class="token function">dynamic</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"../components/hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>DynamicComponent <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token constant">HOME</span> <span class="token constant">PAGE</span> is here<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>DynamicComponent</code>  将是返回的默认组件 <code>../components/hello</code> 。它的工作方式类似于 <code>常规的 React 组件</code> ，您可以像平常一样向它传递  <code>props</code> 。</p>
<p>注意：在  <code>import('path/to/component')</code>  中，必须明确写入路径。它不能是 <code>模板字符串</code> ，也不能是 <code>变量</code> 。此外， <code>import()必须位于 dynamic()Next.js 的调用中</code> ，才能将 webpack 包 / 模块 id 与特定 dynamic () 调用相匹配，并在渲染之前预加载它们。 <code>dynamic()不能在 React 渲染内部使用</code> ，因为它需要在模块的顶层进行标记才能预加载工作，类似于  <code>React.lazy</code> .</p>
<h2 id="自动静态优化"><a class="markdownIt-Anchor" href="#自动静态优化">#</a> 自动静态优化</h2>
<p>如果页面没有阻塞数据要求，Next.js 会自动确定页面是静态的（可以预先呈现）。该确定是通过页面中缺少  <code>getServerSideProps</code>  和  <code>getInitialProps</code>  来做出的。<br>
此功能允许 Next.js 发出包含 <code>服务器渲染页面和静态生成页面</code> 的混合应用程序。<br>
此功能的主要好处之一是，优化的页面不需要服务器端计算，并且可以从多个 CDN 位置立即传输给最终用户。其结果是为您的用户提供超快速的加载体验。</p>
<h3 id="怎么运行的"><a class="markdownIt-Anchor" href="#怎么运行的">#</a> 怎么运行的</h3>
<p>如果页面中存在  <code>getServerSideProps</code>  或  <code>getInitialProps</code> ，Next.js 将切换为按需、按请求渲染页面（即服务器端渲染）。<br>
如果不是上述情况，Next.js 将通过将页面预呈现为静态 HTML 来自动 <code>静态优化您的页面</code> 。<br>
在 <code>预渲染期间</code> ，路由器的对象将为空，因为我们在此阶段  <code>query</code>  没有可提供的信息。水化之后，Next.js 将触发应用程序更新以提供对象中的路由参数 query。<br>
注意：使用 <code>动态路由</code> 添加到正在使用的页面的参数  <code>getStaticProps</code>  将始终在对象内可用  <code>query</code> 。</p>
<p><code>next build</code>  将为静态优化的页面发出 <code>.html</code>  文件。例如， <code>pages/about.js</code>  页面的结果是：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">.</span>next<span class="token operator">/</span>server<span class="token operator">/</span>pages<span class="token operator">/</span>about<span class="token punctuation">.</span>html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果您将  <code>getServerSideProps</code>  添加到页面中，那么它将是 JavaScript，如下所示：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">.</span>next<span class="token operator">/</span>server<span class="token operator">/</span>pages<span class="token operator">/</span>about<span class="token punctuation">.</span>js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="src-目录"><a class="markdownIt-Anchor" href="#src-目录">#</a> src 目录</h2>
<p>页面（pages）也可以添加到  <code>src/pages</code>  目录下，作为根目录下的  <code>pages</code>  目录的替代品。</p>
<p>该  <code>src</code>  目录在许多应用程序中非常常见，并且 Next.js 默认支持该目录。</p>
<h3 id="注意事项"><a class="markdownIt-Anchor" href="#注意事项">#</a> 注意事项</h3>
<ul>
<li>如果根目录下的  <code>pages</code>  目录存在的话， <code>src/pages</code>  目录将被忽略</li>
<li>类似  <code>next.config.js</code>  和  <code>tsconfig.json</code>  的配置文件应放在根目录中，将他们移至  <code>src</code>  下的话将无法使用。这同样适用于  <code>public</code>  目录</li>
</ul>
<h2 id="绝对导入"><a class="markdownIt-Anchor" href="#绝对导入">#</a> 绝对导入</h2>
<p>使用 <code>paths</code>  允许您配置模块别名。例如 <code>@/components/*</code>  到  <code>components/*</code> .<br>
 此配置的示例：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// tsconfig.json or jsconfig.json</span>
<span class="token punctuation">{</span>
  <span class="token string">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span>
    <span class="token string">"paths"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">"@/components/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"components/*"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// pages/index.js</span>
<span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">"@/components/button"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">HomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello World</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="source-map"><a class="markdownIt-Anchor" href="#source-map">#</a> Source Map</h2>
<p>开发过程中默认启用源映射。在生产构建过程中，它们被禁用，因为生成源映射会显着增加生成时间和内存使用量。</p>
<p>Next.js 提供了一个配置标志，您可以使用它在生产构建期间启用浏览器源映射生成：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// next.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  productionBrowserSourceMaps<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>启用该选项后  <code>productionBrowserSourceMaps</code> ，源映射将输出到与 JavaScript 文件相同的目录中。Next.js 将根据请求自动提供这些文件。<br>
注意：</p>
<ol>
<li>添加源映射会增加  <code>next build</code>  时间</li>
<li>在  <code>next build</code>  期间增加内存使用量</li>
</ol>
<h1 id="api"><a class="markdownIt-Anchor" href="#api">#</a> API</h1>
<h2 id="nextrouter"><a class="markdownIt-Anchor" href="#nextrouter">#</a> next/router</h2>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> useRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"next/router"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">ActiveLink</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> href <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token punctuation">{</span>
    marginRight<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    color<span class="token operator">:</span> router<span class="token punctuation">.</span>asPath <span class="token operator">===</span> href <span class="token operator">?</span> <span class="token string">"red"</span> <span class="token operator">:</span> <span class="token string">"black"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token punctuation">{</span>href<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ActiveLink<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以下是  <code>userRouter</code>  返回的一些参数:</p>
<ul>
<li><code>pathname</code> ：当前路由。这个路径是 <code>/pages</code>  中的路径，不包括配置的  <code>basePath</code>  或者  <code>locale</code> 。</li>
<li><code>query</code> ：查询字符串</li>
<li><code>asPath</code> ：浏览器中显示的路径（包括 query），但没有配置  <code>basePath</code>  或  <code>locale</code> 。</li>
<li><code>isFallback</code> : 当前页面是否处于回退模式</li>
<li><code>basePath</code></li>
<li><code>locale</code></li>
<li><code>locales</code></li>
<li><code>defaultLocale</code></li>
<li><code>domainLocales</code></li>
<li><code>isReady</code></li>
<li><code>isPreview</code></li>
</ul>
<h3 id="routerpush"><a class="markdownIt-Anchor" href="#routerpush">#</a> router.push</h3>
<p>router.push(url, as, options);<br>
 进入某个路由；第二个参数 as，是为了装饰 URL ，如果你在服务器端设置了自定义路由将会起作用。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  pathname<span class="token operator">:</span> <span class="token string">"/post/[pid]"</span><span class="token punctuation">,</span>
  query<span class="token operator">:</span> <span class="token punctuation">{</span> pid<span class="token operator">:</span> post<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="routerreplace"><a class="markdownIt-Anchor" href="#routerreplace">#</a> router.replace</h3>
<p>router.replace 将阻止在历史堆栈中添加新的 URL 条目。<br>
router.replace(’/home’)<br>
 重定向路由；</p>
<h3 id="routerprefetch"><a class="markdownIt-Anchor" href="#routerprefetch">#</a> router.prefetch</h3>
<p>预读取某个路由的组件内容；仅在生产环境下有效；<br>
router.prefetch(’/dashboard’)</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 假设您有一个登录页面，登录后，您将用户重定向到仪表板。</span>
<span class="token comment">// 对于这种情况，我们可以预取仪表板以进行更快的转换，如以下示例所示：</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useCallback<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"next/router"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> handleSubmit <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/api/login"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      method<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"application/json"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">/* Form data */</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Do a fast client-side transition to the already prefetched dashboard page</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"/dashboard"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Prefetch the dashboard page</span>
    router<span class="token punctuation">.</span><span class="token function">prefetch</span><span class="token punctuation">(</span><span class="token string">"/dashboard"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token comment">/* Form fields */</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">&gt;</span>Login<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>介绍：Next.js 一个非常实用的功能就是你在浏览当前页面的时候，Next.js 会自动 prefetch 页面上所有的站内链接页面。这样一来，当你真正点击某个链接时，就可以迅速加载该页面，快得简直就像是在读取本地文件。可能这就是为什么同样是 client-side navigation (客户端导航)，Next.js 要比常规的 React SPA 的页面跳转快这么多吧！</li>
<li>这个功能在  <code>&lt;Link /&gt;</code>  中是默认开启的。除非像下面这样把  <code>&lt;Link&gt;</code>  的 prefetch 置为 false，Next.js 就不会在当前页面，再去 prefetch 该路由：</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">"/home"</span> prefetch<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>主页<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>prefetch 属性会在后台预读取目标路由页面，默认值为 true。它具有以下特性：</p>
<ol>
<li>处于视口（viewport）中（初始或滚动后）的任何  <code>&lt;Link /&gt;</code>  都将被预加载。通过设置 prefetch={false} 可以禁止页面预取。</li>
<li>当 prefetch 被设置为 false 时，鼠标悬停在  <code>&lt;Link /&gt;</code>  上时仍然会触发预取。</li>
<li>使用 静态生成 的页面（pages）将预加载存有数据的 JSON 文件，以实现更快的页面切换。</li>
<li>预取功能只在生产环境中开启。</li>
</ol>
</li>
<li>
<p>prefetch 的内容是如何存储的？<br>
通过  <code>&lt;link rel="prefetch"&gt;</code>  的方式，浏览器会请求相应的 .js 和 .css 文件，但不会执行它们，而是作为缓存把它们储存在浏览器中。等到用户真正跳转到该 route，需要加载这些文件时，就可以直接从本地加载，不需要请求服务器了，其实也是一种前端提高性能的常见方法。</p>
</li>
</ul>
<h3 id="routerbeforepopstate"><a class="markdownIt-Anchor" href="#routerbeforepopstate">#</a> router.beforePopState</h3>
<p>在路由器处理事件之前拦截</p>
<h3 id="routerback"><a class="markdownIt-Anchor" href="#routerback">#</a> router.back</h3>
<p>返回上一个路由；</p>
<h3 id="routerreload"><a class="markdownIt-Anchor" href="#routerreload">#</a> router.reload</h3>
<p>重载当前路由；</p>
<h2 id="nextlink"><a class="markdownIt-Anchor" href="#nextlink">#</a> next/link</h2>
<p>通过 Link 组件可以启用客户端的路由切换。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">"next/link"</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">"/about"</span> passHref<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>MyButton <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
    <span class="token comment">// /about?name=test</span>
    <span class="token operator">&lt;</span>Link
      href<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        pathname<span class="token operator">:</span> <span class="token string">'/about'</span><span class="token punctuation">,</span>
        query<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'test'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>About us<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
    <span class="token comment">// /blog/my-post</span>
    <span class="token operator">&lt;</span>Link
      href<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        pathname<span class="token operator">:</span> <span class="token string">'/blog/[slug]'</span><span class="token punctuation">,</span>
        query<span class="token operator">:</span> <span class="token punctuation">{</span> slug<span class="token operator">:</span> <span class="token string">'my-post'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>Blog Post<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="nextimage"><a class="markdownIt-Anchor" href="#nextimage">#</a> next/image</h2>
<h3 id="图片优化方案"><a class="markdownIt-Anchor" href="#图片优化方案">#</a> 图片优化方案</h3>
<ul>
<li>使用 nextjs 内置的 Image 组件，该组件可以自动优化图片以提升网站性能。</li>
<li>使用 nextjs 内置的图片处理功能，自动调整大小、压缩和优化图片。</li>
</ul>
<h3 id="image-组件优势"><a class="markdownIt-Anchor" href="#image-组件优势">#</a> Image 组件优势</h3>
<ul>
<li>
<p>性能提升：使用现代图片格式，为每台设备提供合适尺寸的图片<br>
 webp 是一种现代图像格式，可为 web 上的图像提供卓越的无损和有损压缩。使用 webp，网站管理员和 web 开发人员可以创建更小、更丰富的图像，从而使 web 更快，性能更好。</p>
</li>
<li>
<p>视觉稳定性：自动阻止非预期内容偏移，简称  <code>CLS</code> 。</p>
<ul>
<li>网站中的资源是异步下载的，页面内容也是动态添加到页面上，所以内容发生非预期偏移场景比较常见。比如：未设置宽高的 <code>&lt;image&gt;</code> 、 <code>&lt;video&gt;</code>  元素、实际使用的字体与备用大小不一致、可以动态变更大小的第三方广告或者组件都有可能是导致页面发生非预期偏移。</li>
<li>可以给  <code>image</code> 、 <code>video</code>  元素设置  <code>size</code>  属性，或者预留  <code>image</code>  需要的布局空间。这个做法确保让浏览器在图片正在加载时就分配好正确的布局空间，避免非预期内容偏移。</li>
</ul>
</li>
<li>
<p>更快的页面加载速度：图像只有在进入网页视口时才会被加载，并带有可选的模糊占位符，用于图片未加载完成时的临时占位图片，类似于图片懒加载技术。</p>
</li>
</ul>
<h3 id="用法"><a class="markdownIt-Anchor" href="#用法">#</a> 用法</h3>
<ul>
<li>Image 组件属性介绍
<ul>
<li><code>width</code>  和  <code>height</code>  属性：设置图片宽度和高度，可以只设置其中一个属性，另一个属性自适应调整大小。</li>
<li><code>src</code>  属性：设置图片资源地址，可以是远程图片、本地图片。</li>
<li><code>alt</code>  属性：图片加载失败时的文本提示。</li>
<li><code>layout</code>  属性：设置图片在容器中如何展示。</li>
</ul>
</li>
</ul>
<h4 id="layout-属性"><a class="markdownIt-Anchor" href="#layout-属性">#</a> layout 属性</h4>
<p>在不知道图像的宽度和高度的前提下，仍希望图片在保持纵横比的同时填满整个父盒子空间。在这种情况下，您可以省略  <code>Image</code>  组件上的  <code>width</code>  和  <code>height</code>  属性。相反，添加一个 <code> layout="fill"</code>  的  <code>prop</code>  属性。这会将图像拉伸到父盒子的宽度和高度。使用  <code>layout="fill"</code>  属性时，最好将其与  <code>objectFit="cover"</code>  配对。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Image <span class="token keyword">from</span> <span class="token string">"next/legacy/image"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> test <span class="token keyword">from</span> <span class="token string">"@/assets/imgs/test.jpg"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">ImageCom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// 给父元素设置容器大小，并设定position: "relative"。</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"ImageCom"</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div
        className<span class="token operator">=</span><span class="token string">"img"</span>
        style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> position<span class="token operator">:</span> <span class="token string">"relative"</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token string">"300px"</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token string">"500px"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Image src<span class="token operator">=</span><span class="token punctuation">{</span>test<span class="token punctuation">}</span> layout<span class="token operator">=</span><span class="token string">"fill"</span> alt<span class="token operator">=</span><span class="token string">"加载失败"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Image<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h5<span class="token operator">&gt;</span>图片优化<span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在保证图片纵横比不失真，不变形的同时，不适合父元素的图像部分将被剪裁。</p>
<ul>
<li>
<p><code>layout</code>  属性取值</p>
<ul>
<li><code>fill</code> ：在  <code>x</code>  轴和  <code>y</code>  轴同比缩放，以保证图片能够充满整个父容器空间。</li>
<li><code>responsive</code> ：在  <code>x</code>  轴缩放，以保证图片的宽度充满父容器空间，高度则不保证，高度会自适应。</li>
<li><code>fixed</code> ：按图片自身宽度和高度精确尺寸。图像尺寸不会随着视口的变化而变化（无响应），类似于本地 img 元素了。</li>
</ul>
</li>
<li>
<p><code>quality</code>  属性<br>
优化图像的质量，是 1 和 100 之间的整数，其中 100 是最好的质量，默认为 75。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>Image src<span class="token operator">=</span><span class="token punctuation">{</span>test<span class="token punctuation">}</span> layout<span class="token operator">=</span><span class="token string">"responsive"</span> quality<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">60</span><span class="token punctuation">}</span> alt<span class="token operator">=</span><span class="token string">"加载失败"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Image<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li>
<p><code>blurDataURL</code>  属性<br>
 <code>blurDataURL</code>  属性是占位符图片，在  <code>src</code>  图片成功加载之前加载，必须是  <code>base64</code>  编码的图片，只有与  <code>placeholder="blur"</code>  结合使用时才有效。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>Image
  src<span class="token operator">=</span><span class="token punctuation">{</span>test<span class="token punctuation">}</span>
  layout<span class="token operator">=</span><span class="token string">"responsive"</span>
  quality<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">60</span><span class="token punctuation">}</span>
  alt<span class="token operator">=</span><span class="token string">"加载失败"</span>
  placeholder<span class="token operator">=</span><span class="token string">"blur"</span>
  blurDataURL<span class="token operator">=</span><span class="token string">"data:image/png;base64,..."</span>
<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Image<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h4 id="远程图片"><a class="markdownIt-Anchor" href="#远程图片">#</a> 远程图片</h4>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>Image
  src<span class="token operator">=</span><span class="token string">"https://img0.baidu.com/it/u=726620871,4203188840&amp;fm=253&amp;fmt=auto&amp;app=120&amp;f=JPEG?w=1280&amp;h=800"</span>
  width<span class="token operator">=</span><span class="token string">"300"</span>
  height<span class="token operator">=</span><span class="token string">"200"</span>
<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Image<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要配置 next.config.js 文件，配置远程图片域名</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> nextConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  experimental<span class="token operator">:</span> <span class="token punctuation">{</span>
    appDir<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  images<span class="token operator">:</span> <span class="token punctuation">{</span>
    domains<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"img0.baidu.com"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> nextConfig<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="nextscript"><a class="markdownIt-Anchor" href="#nextscript">#</a> next/script</h2>
<p>Next.js 提供了  <code>next/script</code>  组件来更加方便的管理和加载外部脚本。</p>
<p>它包含了；</p>
<ul>
<li>异步加载外部脚本的能力，从而避免阻塞页面渲染。</li>
<li>脚本的优化，包括 preloading 和 prebrowsing。</li>
<li>支持内联脚本和外联脚本。</li>
<li>支持多种异步加载方式，例如 async, defer 等。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Script <span class="token keyword">from</span> <span class="token string">"next/script"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello World<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Script
        src<span class="token operator">=</span><span class="token string">"https://www.google-analytics.com/analytics.js"</span>
        strategy<span class="token operator">=</span><span class="token string">"afterInteractive"</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MyComponent<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到， <code>src</code>  属性指定了要加载的脚本的 URL，并且我们使用  <code>strategy</code>  属性指定了在何时加载脚本。<br>
Next.js 提供了四种策略：</p>
<ol>
<li>beforeInteractive：在页面的 DOMContentLoaded 事件之前加载。</li>
<li>afterInteractive：在页面的 DOMContentLoaded 事件之后，和其他 async 或 defer 的脚本之前加载。</li>
<li>lazyOnload：在页面的 onload 事件之前加载。</li>
<li>lazy：在页面的 onload 事件之后加载。</li>
</ol>
<h2 id="nexthead"><a class="markdownIt-Anchor" href="#nexthead">#</a> next/head</h2>
<p>Next.js 暴露了一个内置组件，用于将 HTML 标签添加到页面的  <code>head</code>  中：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Head <span class="token keyword">from</span> <span class="token string">"next/head"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">IndexPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>My page title<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"initial-scale=1.0, width=device-width"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Hello world<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 为了避免在 head 中出现重复的 HTML 标签，你可以设置 key 属性，该属性将确保添加的标签仅渲染一次，如以下示例所示：</span>
<span class="token keyword">function</span> <span class="token function">IndexPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>My page title<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta property<span class="token operator">=</span><span class="token string">"og:title"</span> content<span class="token operator">=</span><span class="token string">"My page title"</span> key<span class="token operator">=</span><span class="token string">"title"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta property<span class="token operator">=</span><span class="token string">"og:title"</span> content<span class="token operator">=</span><span class="token string">"My new title"</span> key<span class="token operator">=</span><span class="token string">"title"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Hello world<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 在这种情况下，仅渲染第二个 &lt;meta property="og:title" /&gt;。具有相同 key 属性的 meta 标签将会被自动处理。</span>

<span class="token comment">// 在 unmount 组件时，head 中的内容将会被清理，因此请确保每个页面都定义了其所需的所有内容，不要假设其它页面帮你添加任何内容。</span>
<span class="token comment">// title、meta 或任何其它 HTML 标签（例如 script）必须作为 Head 元素的 直接 子元素存在， 或者被包裹在最多一层 &lt;React.Fragment&gt; 或数组中，否则在客户端导航时这些标签无法被正确识别并使用。</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> IndexPage<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="getinitialprops"><a class="markdownIt-Anchor" href="#getinitialprops">#</a> getInitialProps</h2>
<p><code>getInitialProps</code>  能够在页面中进行服务器端渲染，并允许你进行初始数据填充，这意味着在发送页面时已经在服务端中填充了数据。这对于 SEO 特别有用。<br>
在页面组件中使用了  <code>getInitialProps</code>  ，也就说明当前的页面是开启的 SSR 的渲染方式。<br>
从  <code>getInitialProps</code>  返回的数据在服务端渲染时会被序列化，类似于  <code>JSON.stringify</code>  的做法。确保从  <code>getInitialProps</code>  返回的对象是一个纯粹的 Object，而不是使用  <code>Date</code> 、 <code>Map</code>  或  <code>Set</code> 。</p>
<p>执行时机：<br>
 <code>getInitialProps</code>  的执行时机分为两种情况，都是在运行时执行的：</p>
<ul>
<li>直接访问页面时： <code>getInitialProps</code>  会在服务端执行</li>
<li>通过 <code>next/link</code>  或 <code>next/router</code>  跳转到某个页面时，会在客户端执行</li>
</ul>
<p><code>getInitialProps</code>  只能在 <code>页面组件</code> 中使用，在其他子组件中是 <code>不能使用</code> 的。<br>
 <code>getInitialProps</code>  会根据情况在服务端或者客户端执行，如果我在  <code>getInitialProps</code>  进行了一些 node.js 或者操作了数据库这种纯服务端的操作，当  <code>getInitialProps</code>  在客户端执行时就会报错，除非自己去做兼容处理。由于执行环境不统一， 使用成本较高，因此在  <code>getServerSideProps</code>  引入后，  <code>getInitialProps</code>  就不再被推荐使用了。</p>
<h1 id="nextconfigjs"><a class="markdownIt-Anchor" href="#nextconfigjs">#</a> next.config.js</h1>
<h2 id="base-path"><a class="markdownIt-Anchor" href="#base-path">#</a> Base Path</h2>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  basePath<span class="token operator">:</span> <span class="token string">"/docs"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 设置了basePath，这里会自动去到/docs/about</span>
<span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">"/about"</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>About Page<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="案例"><a class="markdownIt-Anchor" href="#案例">#</a> 案例</h2>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> configs <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 编译文件的输出目录</span>
  distDir<span class="token operator">:</span> <span class="token string">"dest"</span><span class="token punctuation">,</span>
  <span class="token comment">// 是否给每个路由生成Etag</span>
  generateEtags<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 页面内容缓存配置</span>
  onDemandEntries<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 内容在内存中缓存的时长（ms）</span>
    maxInactiveAge<span class="token operator">:</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token comment">// 同时缓存多少个页面</span>
    pagesBufferLength<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 在pages目录下那种后缀的文件会被认为是页面</span>
  pageExtensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"jsx"</span><span class="token punctuation">,</span> <span class="token string">"js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 配置buildId</span>
  <span class="token function-variable function">generateBuildId</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">YOUR_BUILD_ID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">YOUR_BUILD_ID</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 返回null使用默认的unique id</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 手动修改webpack config</span>
  <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 修改webpackDevMiddleware配置</span>
  <span class="token function-variable function">webpackDevMiddleware</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 可以在页面上通过 procsess.env.customKey 获取 value</span>
  env<span class="token operator">:</span> <span class="token punctuation">{</span>
    customKey<span class="token operator">:</span> <span class="token string">"value"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 下面两个要通过 'next/config' 来读取</span>
  <span class="token comment">// 只有在服务端渲染时才会获取的配置</span>
  serverRuntimeConfig<span class="token operator">:</span> <span class="token punctuation">{</span>
    mySecret<span class="token operator">:</span> <span class="token string">"secret"</span><span class="token punctuation">,</span>
    secondSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SECOND_SECRET</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 在服务端渲染和客户端渲染都可获取的配置</span>
  publicRuntimeConfig<span class="token operator">:</span> <span class="token punctuation">{</span>
    staticFolder<span class="token operator">:</span> <span class="token string">"/static"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Mrr-cxh</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://mrr-cxh.github.io/2023/11/05/next-2.0/">https://mrr-cxh.github.io/2023/11/05/next-2.0/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Mrr-cxh</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%A1%86%E6%9E%B6/">
                                    <span class="chip bg-color">框架</span>
                                </a>
                            
                                <a href="/tags/Next/">
                                    <span class="chip bg-color">Next</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2023/11/05/next-2.0/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="Next 2.0">
                        
                        <span class="card-title">Next 2.0</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Next是一个React开发框架。它能确保您和您的团队成功地构建 React 应用程序。Next.js 具有同类框架中最佳的“开发人员体验”和许多内置功能。比如：服务端渲染(SSR)和页面级的静态生成(SSG)；基于页面的路由系统(并支持动态路由)；具有经过优化的预取功能的客户端路由…….Next.js被用于数以万计的网站和Web应用程序，包括许多世界上最大的品牌都在使用Next.js。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-11-05
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%A1%86%E6%9E%B6/" class="post-category">
                                    框架
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%A1%86%E6%9E%B6/">
                        <span class="chip bg-color">框架</span>
                    </a>
                    
                    <a href="/tags/Next/">
                        <span class="chip bg-color">Next</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/10/15/next-xing-neng-you-hua/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="Next 性能优化">
                        
                        <span class="card-title">Next 性能优化</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Next是一个React开发框架。它能确保您和您的团队成功地构建 React 应用程序。Next.js 具有同类框架中最佳的“开发人员体验”和许多内置功能。比如：服务端渲染(SSR)和页面级的静态生成(SSG)；基于页面的路由系统(并支持动态路由)；具有经过优化的预取功能的客户端路由…….Next.js被用于数以万计的网站和Web应用程序，包括许多世界上最大的品牌都在使用Next.js。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-10-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%A1%86%E6%9E%B6/" class="post-category">
                                    框架
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%A1%86%E6%9E%B6/">
                        <span class="chip bg-color">框架</span>
                    </a>
                    
                    <a href="/tags/Next/">
                        <span class="chip bg-color">Next</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2023</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">Mrr-cxh</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">192.8k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Mrr-cxh" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1361091680@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1361091680" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1361091680" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
